<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Membership List</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
            href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600&display=swap"
            rel="stylesheet"
    />
    <link
            rel="stylesheet"
            href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@48,700,1,0"
    />
    <link
            href="https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css"
            rel="stylesheet"
    />
    <script src="https://unpkg.com/akar-icons-fonts"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/1.11.5/css/jquery.dataTables.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="/js/alert.js"></script>
</head>
<body >
<style>
    body {
    background-color: #b8a890;
    font-family: Arial, sans-serif;
}

.container {
    background-color: #a89c86;
    padding: 20px;
    border-radius: 8px;
}

h2 {
    color: white;
}

table {
    background-color: #a89c86;
    border-collapse: collapse;
    width: 100%;
    color: white;
}

thead {
    background-color: #80725f;
    color: white;
}

th, td {
    padding: 10px;
    text-align: left;
    border: 1px solid #9c8c72;
}

tr:nth-child(even) {
    background-color: #9c8c72;
}

.btn-primary {
    background-color: #5a4a3f;
    border: none;
}

.btn-primary:hover {
    background-color: #3e322a;
}

.btn-danger {
    background-color: #d66a4d;
    border: none;
}

.btn-danger:hover {
    background-color: #b8543e;
}

</style>
<style>
    * {
        box-sizing: border-box;
    }

    body {
        margin: 0;
        background-color: #C0B8AB !important;
        background-size: cover;
        background-repeat: no-repeat;
        background-position: 30%;
        height: 100vh;
        font-family: "Euclid Circular A";
    }

    button,
    label {
        background: transparent;
        border: 0;
        padding: 0;
        cursor: pointer;
        text-align: left;
    }

    .sidebar {
        position: fixed;
        top: 24px;
        left: 24px;
        bottom: 44px;
        display: flex;
        flex-direction: column;
        gap: 8px;
        width: 260px;
        border-radius: 16px;
        padding: 0 16px;
        background: rgb(0 0 0 / 32%);
        backdrop-filter: blur(30px);
        transition: width 0.4s;
    }

    .sidebar header {
        display: flex;
        align-items: center;
        height: 72px;
        padding-top: 10px;
        border-bottom: 1px solid rgb(255 255 255 / 8%);
    }

    .logo-text {
        font-size: 24px;
        font-weight: bold;
        color: #F76D37;
        margin: 0;
        padding: 0;
        font-family: "Euclid Circular A", sans-serif;
    }

    .sidebar input {
        scale: 0;
        position: absolute;
    }

    .sidebar input#settings:checked ~ div {
        height: 150px;
    }

    .sidebar input#create:checked ~ div {
        height: 200px;
    }

    .sidebar input#profile:checked ~ div {
        height: 100px;
    }

    .sidebar :is(button, label) {
        position: relative;
        display: flex;
        gap: 16px;
        align-items: center;
        height: 50px;
        width: 100%;
        border-radius: 6px;
        font-family: inherit;
        font-size: 16px;
        font-weight: 400;
        line-height: 1;
        padding: 0 16px;
        color: rgb(255 255 255 / 95%);
    }

    .sidebar label p:nth-child(2) {
        flex: 1 1 auto;
    }

    .sidebar input:checked ~ label {
        background: #1960f3;
    }

    .sidebar label i {
        transition: 0.3s;
    }

    .sidebar input:checked ~ label > i:nth-child(3) {
        rotate: -180deg;
    }

    .sidebar input:not(:checked) ~ label:hover,
    .sidebar button:hover {
        background: rgb(0 0 0 / 15%);
    }

    .sidebar ul {
        display: grid;
        list-style: none;
        padding: 0;
        margin: 0;
        width: 100%;
    }

    .sub-menu {
        position: relative;
        overflow: hidden;
        height: 0;
        transition: 0.5s;
    }

    .sub-menu ul {
        position: absolute;
        top: 0;
        left: 0;
        display: grid;
    }

    .sub-menu button {
        padding-left: 52px;
    }

    .sub-menu button::before {
        content: "";
        position: absolute;
        top: 50%;
        left: 24px;
        translate: 0 -50%;
        width: 5px;
        height: 5px;
        border-radius: 50%;
        background-color: rgb(255 255 255 / 35%);
    }

    .sidebar .material-symbols-outlined {
        font-size: 16px;
    }

    .sidebar i {
        font-size: 20px;
        width: 20px;
        max-width: 20px;
        min-width: 20px;
    }

    .content {
        margin-left: 300px;
        padding: 20px;
        width: calc(100% - 300px);
        background-color: #a89c86;
        border-radius: 10px;
     }

</style>

<aside class="sidebar">
    <header>
        <h1 class="logo-text">Admin Page</h1>
    </header>

    <ul>
        <li>
            <input type="radio" id="dashboard" name="sidebar" />
            <label for="dashboard">
                <i class="ai-dashboard"></i>
                <p>Dashboard</p>
            </label>
        </li>
        <li>
            <input type="radio" id="settings" name="sidebar" />
            <label for="settings">
                <i class="ai-gear"></i>
                <p>Customers</p>
                <i class="ai-chevron-down-small"></i>
            </label>
            <div class="sub-menu">
                <ul>
                    <li>
                        <button type="button">Customers List</button>
                    </li>
                    <li>
                        <button type="button">Members List</button>
                    </li>
                </ul>
            </div>
        </li>
        <li>
            <input type="radio" id="create" name="sidebar" />
            <label for="create">
                <i class="ai-folder-add"></i>
                <p>Create</p>
                <i class="ai-chevron-down-small"></i>
            </label>
            <div class="sub-menu">
                <ul>
                    <li>
                        <button type="button">Article</button>
                    </li>
                    <li>
                        <button type="button">Document</button>
                    </li>
                    <li>
                        <button type="button">Video</button>
                    </li>
                    <li>
                        <button type="button">Presentation</button>
                    </li>
                </ul>
            </div>
        </li>
        <li>
            <input type="radio" id="profile" name="sidebar" />
            <label for="profile">
                <i class="ai-person"></i>
                <p>Profile</p>
                <i class="ai-chevron-down-small"></i>
            </label>
            <div class="sub-menu">
                <ul>
                    <li>
                        <button type="button">Avatar</button>
                    </li>
                    <li>
                        <button type="button">Theme</button>
                    </li>
                </ul>
            </div>
        </li>
        <li>
            <input type="radio" id="notifications" name="sidebar" />
            <label for="notifications">
                <i class="ai-bell"></i>
                <p>Notifications</p>
            </label>
        </li>
        <li>
            <input type="radio" id="products" name="sidebar" />
            <label for="products">
                <i class="ai-cart"></i>
                <p>Products</p>
            </label>
        </li>
        <li>
            <input type="radio" id="account" name="sidebar" />
            <label for="account">
                <i class="ai-lock-on"></i>
                <p>Account</p>
            </label>
        </li>
    </ul>
</aside>
<div class="content mt-5">
    <h2 class="text-2xl">Membership List</h2>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <label for="rankFilter" class="me-2">Filter by Rank:</label>
            <select id="rankFilter" class="form-select d-inline-block w-auto">
                <option value="">None</option>
                <option th:each="rankItem : ${listRank}"
                        th:value="${rankItem}"
                        th:text="${rankItem}"
                        th:selected="${rankItem == param.rank}">
                </option>
            </select>

        </div>
        <button class="btn btn-primary" id="openModal">Add membership</button>
    </div>

    <table id="membershipTable" class="table table-bordered table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Customer</th>
            <th>Email</th>
            <th>Rank</th>
            <th>Point</th>
<!--            <th>ExpiryDate</th>-->
<!--            <th>Action</th>-->
        </tr>
        </thead>
        <tbody>
        <tr th:each="membership : ${listMembershipByRank}">
            <td th:text="${membership.id}"></td>
            <td th:text="${membership.name}"></td>
            <td th:text="${membership.email}"></td>
            <td th:text="${membership.rank}"></td>
            <td th:text="${membership.point}"></td>
<!--            <td>-->
<!--                <button class="btn btn-sm btn-primary openUpdateModal">Update</button>-->
<!--            </td>-->
        </tr>
        </tbody>
    </table>
</div>

<!-- Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="modalTitle" class="text-2xl mb-2">Add Customer to Membership Rank</h3>

        <!-- Select rank với tùy chọn "Create Rank" -->
        <div class="mb-3 flex items-center gap-3">
            <label for="rankSelect" class="whitespace-nowrap">Select Rank:</label>
            <select id="rankSelect" class="flex-1 p-2 border border-gray-300 rounded">
                <option th:each="rankItem : ${listRank}"
                        th:value="${rankItem}"
                        th:text="${rankItem}"
                        th:selected="${rankItem == param.rank}">
                </option>
                <option value="create">➕ Create Rank</option>
            </select>
        </div>


        <!-- Input để nhập rank mới -->
        <div id="customRankInput" class="mb-3 hidden">
            <input type="text" id="newRank" class="form-control" placeholder="Enter new rank">
        </div>

        <!-- Data Table trong Modal -->
        <table id="modalTable" class="table table-bordered my-2">
            <thead>
            <tr>
                <th>Select</th>
                <th>Customer</th>
                <th>Email</th>
                <th>Rank</th>
                <th>Point</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="membership : ${listAllCustomer}">
                <td>
                    <input type="checkbox" class="customerCheckbox" th:value="${membership.userId}">
                </td>
                <td th:text="${membership.name}"></td>
                <td th:text="${membership.email}"></td>
                <td th:text="${membership.rank}"></td>
                <td th:text="${membership.point}"></td>
            </tr>
            </tbody>
        </table>

        <button id="saveBtn" class="btn btn-primary mb-2">Save</button>
        <button id="closeModal" class="btn btn-secondary">Close</button>
    </div>
</div>

<script>
    const modal = document.getElementById("myModal");
    const openModalBtn = document.getElementById("openModal");
    const closeModalBtn = document.getElementById("closeModal");
    const closeSpan = document.querySelector(".close");
    const modalTitle = document.getElementById("modalTitle");
    const rankSelect = document.getElementById("rankSelect");
    const customRankInput = document.getElementById("customRankInput");
    const updateButtons = document.querySelectorAll(".openUpdateModal");

    // Sự kiện mở modal (Thêm khách hàng)
    openModalBtn.addEventListener("click", () => {
      modal.style.display = "block";
      modalTitle.textContent = "Add Customer to Membership Rank";
    });

    // Sự kiện mở modal (Cập nhật)
    updateButtons.forEach(button => {
      button.addEventListener("click", () => {
        modal.style.display = "block";
        modalTitle.textContent = "Update Membership Rank";
      });
    });

    // Sự kiện đóng modal
    closeModalBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    closeSpan.addEventListener("click", () => {
      modal.style.display = "none";
    });

    window.addEventListener("click", (event) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });

    // Hiển thị input khi chọn "Create Rank"
    rankSelect.addEventListener("change", () => {
      if (rankSelect.value === "create") {
        customRankInput.classList.remove("hidden");
      } else {
        customRankInput.classList.add("hidden");
      }
    });

    document.addEventListener("DOMContentLoaded", function () {
        const rankFilter = document.getElementById("rankFilter");

        // Lấy giá trị rank từ URL
        const urlParams = new URLSearchParams(window.location.search);
        const selectedRank = urlParams.get("rank");

        // Gán giá trị rank cho dropdown nếu có trong URL
        if (selectedRank) {
            rankFilter.value = selectedRank;
        }

        // Chuyển hướng khi chọn rank
        rankFilter.addEventListener("change", function () {
            window.location.href = "/membership?rank=" + this.value;
        });
    });

    $(document).ready(function () {
        $('#membershipTable').DataTable({
            "paging": true,
            "pageLength": 5,
            "lengthChange": false,
            "ordering": true,
            "info": true
        });

        $('#modalTable').DataTable({
            "paging": true,
            "pageLength": 5,
            "lengthChange": false,
            "ordering": true,
            "info": true
        });
    });


</script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const modal = document.getElementById("myModal");
        const saveBtn = document.getElementById("saveBtn");
        const rankSelect = document.getElementById("rankSelect");
        const customRankInput = document.getElementById("customRankInput");
        const newRankInput = document.getElementById("newRank");

        saveBtn.addEventListener("click", function () {
            let selectedCustomers = [];

            document.querySelectorAll(".customerCheckbox:checked").forEach((checkbox) => {
                selectedCustomers.push(parseInt(checkbox.value));
            });

            console.log("Selected Customers:", selectedCustomers);

            let selectedRank = rankSelect.value === "create" ? newRankInput.value.trim() : rankSelect.value;

            if (!selectedRank) {
                showMessage("Please enter a rank name.", "warning");
                return;
            }

            if (selectedCustomers.length === 0) {
                showMessage("Please select at least one user.", "warning");
                return;
            }

            let data = {
                rank: selectedRank,
                listUserId: selectedCustomers
            };

            fetch("/save-data-membership", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(data)
            })
            .then(response => {
                if (!response.ok) throw new Error("Request failed!");
                return response.text(); // Chuyển đổi thành text thay vì JSON
            })
            .then(message => {
                console.log("Server Response:", message); // Kiểm tra phản hồi từ server
                if (message === "Save success") {
                    showMessage(message, "success");
                    modal.style.display = "none";
                    setTimeout(() => window.location.reload(), 500); // Reload sau 0.5s để đảm bảo modal đã ẩn
                } else {
                    showMessage(message, "error");
                }
            })
            .catch(error => {
                console.error("Error:", error);
                showMessage("An error occurred!", "error");
            });


        });
    });
</script>


<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
    /* Tùy chỉnh ô tìm kiếm */
    .dataTables_filter input {
        width: 200px !important; /* Độ rộng */
        height: 35px; /* Chiều cao */
        padding: 5px 10px; /* Khoảng cách trong */
        border: 2px solid #007bff; /* Viền màu xanh */
        border-radius: 5px; /* Bo góc */
        outline: none;
        background-color: white;
    }

    /* Khi focus vào ô tìm kiếm */
    .dataTables_filter input:focus {
        border-color: #0056b3; /* Viền đậm hơn */
        box-shadow: 0 0 5px rgba(0, 91, 187, 0.5); /* Hiệu ứng sáng */
    }

    /* Tùy chỉnh vùng chứa ô tìm kiếm */
    .dataTables_filter {
        text-align: left !important; /* Căn trái */
        margin-bottom: 10px; /* Khoảng cách với bảng */
    }

    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      position: relative;
      text-align: center;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }
</style>
</body>
</html>