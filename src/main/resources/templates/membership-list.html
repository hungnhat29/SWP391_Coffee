<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>Membership List</title>
</head>
<body th:fragment="membershipTable">
<div class="container mt-5">
    <h2 class="text-2xl">Membership List</h2>

    <div class="d-flex justify-content-between align-items-center mb-3">
        <div>
            <label for="rankFilter" class="me-2">Filter by Rank:</label>
            <select id="rankFilter" class="form-select d-inline-block w-auto">
                <option value="">All</option>
                <option th:each="rankItem : ${listRank}"
                        th:value="${rankItem}"
                        th:text="${rankItem}"
                        th:selected="${rankItem == param.rank}">
                </option>
            </select>

        </div>
        <button class="btn btn-primary" id="openModal">Add membership</button>
    </div>

    <table id="membershipTable" class="table table-bordered table-striped">
        <thead>
        <tr>
            <th>ID</th>
            <th>Customer</th>
            <th>Email</th>
            <th>Rank</th>
            <th>Type</th>
            <th>ExpiryDate</th>
<!--            <th>Action</th>-->
        </tr>
        </thead>
        <tbody>
        <tr th:each="membership : ${listMembershipByRank}">
            <td th:text="${membership.id}"></td>
            <td th:text="${membership.name}"></td>
            <td th:text="${membership.email}"></td>
            <td th:text="${membership.rank}"></td>
            <td th:text="${membership.phone}"></td>
<!--            <td>-->
<!--                <button class="btn btn-sm btn-primary openUpdateModal">Update</button>-->
<!--            </td>-->
        </tr>
        </tbody>
    </table>
</div>

<!-- Modal -->
<div id="myModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h3 id="modalTitle" class="text-2xl mb-2">Add Customer to Membership Rank</h3>

        <!-- Select rank với tùy chọn "Create Rank" -->
        <div class="mb-3 flex items-center gap-3">
            <label for="rankSelect" class="whitespace-nowrap">Select Rank:</label>
            <select id="rankSelect" class="flex-1 p-2 border border-gray-300 rounded">
                <option value="Bronze">Bronze</option>
                <option value="Silver">Silver</option>
                <option value="Gold">Gold</option>
                <option value="Platinum">Platinum</option>
                <option value="create">➕ Create Rank</option>
            </select>
        </div>


        <!-- Input để nhập rank mới -->
        <div id="customRankInput" class="mb-3 hidden">
            <input type="text" id="newRank" class="form-control" placeholder="Enter new rank">
        </div>

        <!-- Data Table trong Modal -->
        <table id="modalTable" class="table table-bordered">
            <thead>
            <tr>
                <th>ID</th>
                <th>Customer</th>
                <th>Email</th>
                <th>Rank</th>
                <th>Type</th>
                <th>ExpiryDate</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="membership : ${listAllCustomer}">
                <td th:text="${membership.id}"></td>
                <td th:text="${membership.name}"></td>
                <td th:text="${membership.email}"></td>
                <td th:text="${membership.rank}"></td>
                <td th:text="${membership.phone}"></td>
            </tr>
            </tbody>
        </table>

        <div class="flex gap-4 mb-4">
            <!-- Field Type -->
            <div class="flex-1">
                <label for="customerType" class="block font-medium mb-1">Type:</label>
                <input type="text" id="customerType" class="w-full p-2 border border-gray-300 rounded"
                       placeholder="Enter type">
            </div>

            <!-- Field Expiry Date -->
            <div class="flex-1">
                <label for="expiryDate" class="block font-medium mb-1">Expiry Date:</label>
                <input type="date" id="expiryDate" class="w-full p-2 border border-gray-300 rounded">
            </div>
        </div>
        <button id="saveBtn" class="btn btn-primary mb-2">Save</button>
        <button id="closeModal" class="btn btn-secondary">Close</button>
    </div>
</div>

<script>
    const modal = document.getElementById("myModal");
    const openModalBtn = document.getElementById("openModal");
    const closeModalBtn = document.getElementById("closeModal");
    const closeSpan = document.querySelector(".close");
    const modalTitle = document.getElementById("modalTitle");
    const rankSelect = document.getElementById("rankSelect");
    const customRankInput = document.getElementById("customRankInput");
    const updateButtons = document.querySelectorAll(".openUpdateModal");

    // Sự kiện mở modal (Thêm khách hàng)
    openModalBtn.addEventListener("click", () => {
      modal.style.display = "block";
      modalTitle.textContent = "Add Customer to Membership Rank";
    });

    // Sự kiện mở modal (Cập nhật)
    updateButtons.forEach(button => {
      button.addEventListener("click", () => {
        modal.style.display = "block";
        modalTitle.textContent = "Update Membership Rank";
      });
    });

    // Sự kiện đóng modal
    closeModalBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    closeSpan.addEventListener("click", () => {
      modal.style.display = "none";
    });

    window.addEventListener("click", (event) => {
      if (event.target === modal) {
        modal.style.display = "none";
      }
    });

    // Hiển thị input khi chọn "Create Rank"
    rankSelect.addEventListener("change", () => {
      if (rankSelect.value === "create") {
        customRankInput.classList.remove("hidden");
      } else {
        customRankInput.classList.add("hidden");
      }
    });

    document.getElementById("rankFilter").addEventListener("change", function () {
        const selectedRank = this.value;
        window.location.href = "/get-data-membership-by-rank?rank=" + selectedRank;
    });
</script>
<script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
<style>
    .modal {
      display: none;
      position: fixed;
      z-index: 1000;
      left: 0;
      top: 0;
      width: 100%;
      height: 100%;
      background-color: rgba(0, 0, 0, 0.5);
    }

    .modal-content {
      background-color: white;
      margin: 10% auto;
      padding: 20px;
      border-radius: 8px;
      width: 90%;
      max-width: 600px;
      position: relative;
      text-align: center;
    }

    .close {
      position: absolute;
      top: 10px;
      right: 15px;
      font-size: 20px;
      cursor: pointer;
    }

    .hidden {
      display: none;
    }
</style>
</body>
</html>