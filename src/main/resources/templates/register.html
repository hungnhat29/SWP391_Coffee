<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <title>
    Register
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
<div class="bg-white shadow-md rounded-lg flex flex-col md:flex-row w-full max-w-4xl">
  <div class="md:w-1/2">
    <img alt="A cup of coffee with coffee beans and a spoon on the side" class="w-full h-full p-5 object-cover rounded-lg" height="400" src="https://storage.googleapis.com/a1aa/image/Bcjq5Mgfb-B9kQkWqEaKi6j7eRs8W7RHJM7KDh8W45k.jpg" width="600"/>
  </div>
  <div class="md:w-1/2 p-8">
    <h2 class="text-2xl font-bold mb-6 text-center">
      Register
    </h2>
    <form id="registerForm">
      <div class="mb-4">
        <label class="block text-gray-700">Fullname</label>
        <input type="text" id="fullName" name="fullName" class="w-full px-3 py-2 border rounded-lg"/>
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Phone</label>
        <input type="text" id="phone" name="phone" class="w-full px-3 py-2 border rounded-lg"/>
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Email</label>
        <input type="email" id="email" name="email" class="w-full px-3 py-2 border rounded-lg"/>
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Password</label>
        <input type="password" id="password" name="password" class="w-full px-3 py-2 border rounded-lg"/>
      </div>
      <div class="mb-4">
        <label class="block text-gray-700">Re-password</label>
        <input type="password" id="confirmPassword" name="confirmPassword" class="w-full px-3 py-2 border rounded-lg"/>
      </div>
      <div class="mb-6">
        <button type="submit" class="w-full bg-orange-500 text-white py-2 rounded-lg hover:bg-orange-600">
          SUBMIT
        </button>
      </div>
      <p id="error-message" class="text-red-500 text-sm text-center"></p>
    </form>
    <div class="text-center">
      <p class="text-gray-700">
        Do you already have an account?
        <a class="text-black font-bold" th:href="@{/auth/login}">
          Login
        </a>
      </p>
    </div>
  </div>
</div>
</body>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function () {
    $("#registerForm").submit(function (event) {
      event.preventDefault();

      let formData = {
        fullName: $("#fullName").val(),
        phone: $("#phone").val(),
        email: $("#email").val(),
        password: $("#password").val(),
        confirmPassword: $("#confirmPassword").val()
      };

      if (!formData.fullName || !formData.phone || !formData.email || !formData.password || !formData.confirmPassword) {
        $("#error-message").text("Please fill in all fields!");
        return;
      }

      // Kiểm tra mật khẩu có tối thiểu 6 ký tự bao gồm cả chữ và số
      const passwordRegex = /^(?=.*[A-Za-z])(?=.*\d).{6,}$/;
      if (!passwordRegex.test(formData.password)) {
        $("#error-message").text("Password must be at least 6 characters long and include both letters and numbers.");
        return;
      }

      // Kiểm tra confirmPassword
      if (formData.password !== formData.confirmPassword) {
        $("#error-message").text("Passwords do not match.");
        return;
      }

      $.ajax({
        type: "POST",
        url: "/auth/register",
        contentType: "application/json",
        data: JSON.stringify(formData),
        success: function (response) {
          localStorage.setItem("token", response.token);
          redirectHomePage(response);
        },
        error: function (xhr) {
          let errorMessage = xhr.responseJSON?.message || "Registration failed!";
          $("#error-message").text(errorMessage);
        }
      });
    });
    
    function redirectHomePage(response){
      $.ajax({
        type: "GET",
        url: "/home",
        headers: { "Authorization": "Bearer " + response.token },
        success: function () {
          window.location.href = "/home";
        },
        error: function () {
          alert("Access denied to home");
        }
      });
    }
  });
</script>

</html>
