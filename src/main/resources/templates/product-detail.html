<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <meta charset="UTF-8">
        <title>Product Detail</title>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Poppins:wght@400;500;600&family=SF+Pro+Display:wght@400;500&display=swap" rel="stylesheet"/>
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
        <!-- bootstrap css -->
        <link rel="stylesheet" type="text/css" th:href="@{/css/bootstrap.min.css}">
        <!-- style css -->
        <link rel="stylesheet" type="text/css" th:href="@{/css/headertemplate.css}"/>
        <style>
            .text-brown {
                color: #6F4E37;
            }
            .product-container {
                max-width: 1200px;
                margin: 30px auto;
                padding: 0 15px;
            }
            .product-image {
                width: 100%;
                aspect-ratio: 1;
                object-fit: cover;
                border-radius: 8px;
            }
            .product-title {
                font-family: "SF Pro Display", sans-serif;
                font-size: 26px;
                margin-bottom: 10px;
            }
            .product-price {
                font-family: "SF Pro Display", sans-serif;
                font-size: 24px;
                color: #F76D37;
                font-weight: 500;
                margin-bottom: 20px;
            }
            .options-grid {
                display: flex;
                flex-wrap: wrap;
                gap: 8px;
                margin-bottom: 15px;
            }
            .size-option, .topping-option {
                border: 1px solid #ddd;
                border-radius: 4px;
                padding: 8px 12px;
                cursor: pointer;
                font-size: 14px;
                background: white;
                min-width: 120px;
                text-align: center;
            }
            .size-option.selected, .topping-option.selected {
                border-color: #F76D37;
                background-color: #FFF5F2;
            }
            .option-section {
                margin-bottom: 20px;
            }
            .option-title {
                font-size: 14px;
                font-weight: 500;
                margin-bottom: 10px;
                color: #333;
            }
            .btn-order {
                background-color: #F76D37;
                color: white;
                border: none;
                padding: 10px 20px;
                border-radius: 4px;
                font-size: 14px;
            }
            .btn-order:hover {
                background-color: #E55D2B;
                color: white;
            }
            .btn-store {
                border: 1px solid #ddd;
                background-color: white;
                padding: 10px 20px;
                border-radius: 4px;
                font-size: 14px;
            }
            .btn-store:hover {
                background-color: #f8f9fa;
            }
            .product-description {
                margin-top: 30px;
                padding-top: 20px;
                border-top: 1px solid #eee;
            }
            .buttons-container {
                display: flex;
                gap: 10px;
                margin-top: 20px;
            }
            .buttons-container button {
                flex: 1;
            }

            .profile-item {
                position: relative;
            }

            .logout-menu {
                display: none;
                position: absolute;
                top: 100%; /* Hiển thị bên dưới icon */
                left: 50%;
                transform: translateX(-50%);
                background-color: #fff;
                color: #000;
                padding: 8px 12px;
                border-radius: 8px;
                box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                white-space: nowrap;
                z-index: 10;
            }

            .profile-item:hover .logout-menu {
                display: block;
            }

            .logout-link {
                text-decoration: none;
                color: #000;
                font-weight: bold;
            }

            .recommended-products {
                margin-top: 40px;
                padding-top: 20px;
                border-top: 1px solid #eee;
            }

            .recommended-title {
                font-size: 18px;
                font-weight: 600;
                margin-bottom: 15px;
                color: #333;
            }

            .recommended-list {
                display: flex;
                gap: 15px;
                overflow-x: auto;
                padding-bottom: 10px;
            }

            .recommended-item {
                flex: 0 0 calc(25% - 15px);
                background: white;
                border-radius: 8px;
                text-align: center;
                box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
                transition: transform 0.2s ease-in-out;
            }

            .recommended-item:hover {
                transform: translateY(-5px);
            }

            .recommended-link {
                text-decoration: none;
                color: inherit;
                display: block;
                padding: 10px;
            }

            .recommended-image {
                width: 100%;
                aspect-ratio: 1;
                object-fit: cover;
                border-radius: 8px 8px 0 0;
            }

            .recommended-info {
                padding: 10px;
            }

            .recommended-name {
                font-size: 14px;
                font-weight: 500;
                margin-bottom: 5px;
            }

            .recommended-price {
                font-size: 16px;
                font-weight: 600;
                color: #F76D37;
            }

        </style>
    </head>
    <body>
        <!-- Keep your existing header section -->
        <!--    <div th:replace="~{fragments/header :: header}"></div>-->
        <!--header section start -->
        <div th:replace="~{/header_template :: header_template}"></div>
        <!--header section end -->
        <div class="product-container">
            <div class="row">
                <!-- Product Image -->
                <div class="col-md-6 mb-4">
                    <img th:src="${product.imageUrl != null ? product.imageUrl : '/images/default-product.jpg'}"
                         th:alt="${product.name}"
                         class="product-image">
                </div>

                <!-- Product Info -->
                <div class="col-md-6">
                    <h1 class="product-title" th:text="${product.name}">Product Name</h1>
                    <p class="product-price">
                        <span th:text="${#numbers.formatDecimal(product.basePrice, 0, 'COMMA', 0, 'POINT')}">0</span>đ
                    </p>

                    <!-- Size Selection -->
                    <div class="option-section" th:if="${product.sizes != null and not #lists.isEmpty(product.sizes)}">
                        <div class="option-title">Select size (required)</div>
                        <div class="options-grid">
                            <div th:each="size : ${product.sizes}" 
                                 class="size-option"
                                 th:data-price="${size.price}"
                                 onclick="selectSize(this)">
                                <div th:text="${size.name}">Size name</div>
                                <div th:text="${'+' + #numbers.formatDecimal(size.price, 0, 'COMMA', 0, 'POINT') + 'đ'}">Price</div>
                            </div>
                        </div>
                    </div>

                    <!-- Toppings Selection -->
                    <div class="option-section" th:if="${product.toppings != null and not #lists.isEmpty(product.toppings)}">
                        <div class="option-title">Topping</div>
                        <div class="options-grid">
                            <div th:each="topping : ${product.toppings}" 
                                 class="topping-option"
                                 th:data-price="${topping.price}"
                                 onclick="toggleTopping(this)">
                                <div th:text="${topping.name}">Topping name</div>
                                <div th:text="${'+' + #numbers.formatDecimal(topping.price, 0, 'COMMA', 0, 'POINT') + 'đ'}">Price</div>
                            </div>
                        </div>
                    </div>

                    <div class="buttons-container">
                        <button class="btn btn-order">
                            Đặt giao tận nơi
                        </button>
                        <button class="btn btn-store">
                            Dùng tại quán
                        </button>
                    </div>
                </div>
            </div>

            <!-- Product Description -->
            <div class="product-description">
                <h4>Product description</h4>
                <p th:text="${product.description}">Product description</p>
            </div>

            <!-- Recommended Products -->
            <div class="recommended-products">
                <h4 class="recommended-title">Gợi ý sản phẩm tương tự</h4>
                <div class="recommended-list">
                    <div th:each="recommended : ${listProductRecommend}" class="recommended-item">
                        <a th:href="@{/detail(productId=${recommended.id})}" class="recommended-link">
                            <img th:src="${recommended.imageUrl != null ? recommended.imageUrl : '/images/default-product.jpg'}"
                                 th:alt="${recommended.name}" class="recommended-image">
                            <div class="recommended-info">
                                <div class="recommended-name" th:text="${recommended.name}">Tên sản phẩm</div>
                                <div class="recommended-price">
                                <span
                                        th:text="${#numbers.formatDecimal(recommended.basePrice, 0, 'COMMA', 0, 'POINT')}">0</span>đ
                                </div>
                            </div>
                        </a>
                    </div>
                </div>
            </div>

        </div>

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script>
                                     let basePrice = parseFloat(document.querySelector('.product-price span').textContent.replace(/,/g, ''));
                                     let selectedSize = null;
                                     let selectedToppings = new Set();

                                     function selectSize(element) {
                                         document.querySelectorAll('.size-option').forEach(el => el.classList.remove('selected'));
                                         element.classList.add('selected');
                                         selectedSize = {
                                             price: parseFloat(element.getAttribute('data-price'))
                                         };
                                         updateTotalPrice();
                                     }

                                     function toggleTopping(element) {
                                         element.classList.toggle('selected');
                                         const price = parseFloat(element.getAttribute('data-price'));

                                         if (element.classList.contains('selected')) {
                                             selectedToppings.add(price);
                                         } else {
                                             selectedToppings.delete(price);
                                         }
                                         updateTotalPrice();
                                     }

                                     function updateTotalPrice() {
                                         let total = basePrice;
                                         if (selectedSize) {
                                             total += selectedSize.price;
                                         }
                                         selectedToppings.forEach(price => {
                                             total += price;
                                         });

                                         document.querySelector('.product-price span').textContent = total.toLocaleString();
                                     }
        </script>
        <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
        <script>
                                     function logout() {
                                         fetch('/auth/logout', {
                                             method: 'POST', // Gọi API với phương thức POST
                                             credentials: 'include' // Đảm bảo cookie được gửi kèm
                                         })
                                                 .then(response => {
                                                     if (response.ok) {
                                                         Swal.fire({
                                                             title: "Thành công",
                                                             text: "Đăng xuất thành công!",
                                                             icon: "success",
                                                             timer: 3000,
                                                             showConfirmButton: false
                                                         });
                                                         // Chuyển hướng người dùng về trang đăng nhập hoặc trang chủ
                                                         setTimeout(() => {
                                                             window.location.href = "/login";
                                                         }, 3000);
                                                     } else {
                                                         Swal.fire({
                                                             title: "Lỗi",
                                                             text: "Đăng xuất không thành công!",
                                                             icon: "error",
                                                             timer: 5000,
                                                             showConfirmButton: false
                                                         });
                                                     }
                                                 })
                                                 .catch(error => {
                                                     Swal.fire({
                                                         title: "Lỗi",
                                                         text: "Có lỗi xảy ra, vui lòng thử lại sau.",
                                                         icon: "error",
                                                         timer: 5000,
                                                         showConfirmButton: false
                                                     });
                                                 });
                                     }
        </script>
    </body>
</html>